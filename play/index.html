<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="overflow: hidden; background-color: black;">
<script>
class l{constructor(a,b,c=1,d="square",e=2,g=.5){this.g=null;this.h=a;this.gain=a.createGain();this.i=b.map(f=>Array.from(f));this.j=c;this.type=d;this.m=e;this.l=g}stop(){null!=this.g&&(this.g.stop(0),this.g.disconnect(),this.g=null)}play(a){this.stop();let b=this.h.currentTime,c;this.g=this.h.createOscillator();this.g.type=this.type;a*=this.j;this.g.frequency.setValueAtTime(this.i[0][0],b);this.gain.gain.setValueAtTime(Math.min(1,Math.max(a,.01)),b);c=0;for(let d of this.i){switch(this.m){case 0:this.g.frequency.setValueAtTime(d[0],
b+c);break;case 1:this.g.frequency.linearRampToValueAtTime(d[0],b+c);break;case 2:this.g.frequency.exponentialRampToValueAtTime(d[0],b+c)}c+=1/60*d[1]}this.gain.gain.exponentialRampToValueAtTime(a*this.l,b+c);this.g.connect(this.gain).connect(this.h.destination);this.g.start(b);this.g.stop(b+c)}};class p{constructor(){this.o=(a,b=1,c="square",d=2,e=.5)=>new l(this.g,a,b,c,d,e);this.g=new AudioContext;this.v=1}};const q=(a,b=!0)=>{let c=null;b&&(c=document.createElement("div"),c.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;"));b=document.createElement("canvas");b.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");b.width=160;b.height=a;null!=c&&(c.appendChild(b),document.body.appendChild(c));a=b.getContext("2d");a.imageSmoothingEnabled=!1;return[b,a]},v=(a,b,c,d=1)=>
"rgba("+String(a|0)+","+String(b|0)+","+String(c|0)+","+String(Math.min(1,Math.max(d,0)))+")";function y(a){var b=window.innerWidth,c=window.innerHeight;let d=Math.min(b/a.width,c/a.height);1<=d&&(d=Math.floor(d));let e=a.g.style;e.width=String(d*a.width|0)+"px";e.height=String(d*a.height|0)+"px";e.left=String(b/2-d*a.width/2|0)+"px";e.top=String(c/2-d*a.height/2|0)+"px"}function z(a,b=1){a.h.globalAlpha=Math.min(1,Math.max(b,0));return a}
function A(a,b,c,d,e,g,f,k){if(!(null==b||0>=e||0>=g)){var h=a.h;c|=0;d|=0;e|=0;g|=0;f|=0;k|=0;a=0;0!=a&&h.save();0!=(a&1)&&(h.translate(e,0),h.scale(-1,1),f*=-1);0!=(a&2)&&(h.translate(0,g),h.scale(1,-1),k*=-1);h.drawImage(b,c,d,e,g,f,k,e,g);0!=a&&h.restore()}}function F(a,b,c,d,e){if(null!=b){var g=b.width/16|0,f=e;e=d-=c.length*(g+-16)/2;for(let h=0;h<c.length;++h){var k=c.charCodeAt(h);10==k?(e=d,f+=g+0):(A(a,b,k%16*g,(k/16|0)*g,g,g,e,f),e+=g+-16)}}}
class G{constructor(a,b=!0){this.clear=(c=255,d=c,e=d)=>this.setFillColor(c,d,e).fillRect();this.i=()=>this.g;[this.g,this.h]=q(a,b);b&&(window.addEventListener("resize",()=>y(this)),y(this))}get width(){return this.g.width}get height(){return this.g.height}setFillColor(a=255,b=a,c=b,d=1){this.h.fillStyle=v(a,b,c,d);return this}fillRect(a=0,b=0,c=this.width,d=this.height){this.h.fillRect(a|0,b|0,c|0,d|0);return this}};const H=(a,b,c=a.height)=>{let d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),g=Uint8ClampedArray.from(e.data),f;for(let k=b+1;k<c-1;++k){b=k*a.width+1;for(let h=1;h<a.width-1;++h,++b)if(255==g[4*b+3])for(let m=k-1;m<=k+1;++m)for(let n=h-1;n<=h+1;++n)f=m*a.width+n,0==g[4*f+3]&&(e.data[4*f]=0,e.data[4*f+1]=0,e.data[4*f+2]=0,e.data[4*f+3]=255)}d.putImageData(e,0,0)},I=a=>{let b=new Image;b.onload=()=>{a(b)};b.src="b.png"},J=a=>{let b=new G(176,!1);a(b);return b.i()},K=(a,b,c,d=[255,255,
255],e=!1)=>{let g=document.createElement("canvas");g.width=16*b;g.height=16*c;var f=g.getContext("2d");f.imageSmoothingEnabled=!1;f.font=a;f.textAlign="center";f.fillStyle=v(...d,1);a=32;for(var k=2;8>k;++k)for(let h=0;16>h;++h)f.fillText(String.fromCharCode(a++),(h+.5)*b,(k+.67)*c);b=g.getContext("2d");f=b.getImageData(0,0,g.width,g.height);for(a=0;a<g.width*g.height;++a){for(k=0;3>k;++k)f.data[4*a+k]=d[k];f.data[4*a+3]=127>f.data[4*a+3]?0:255}b.putImageData(f,0,0);e&&H(g,2*c,8*c);return g};function L(a,b,c){b?1!==a.g.get(c)&&a.g.set(c,3):0!==a.g.get(c)&&a.g.set(c,2)}function M(a,b,c,d){a.actions.set(b,[c,d]);a.h.push(c);void 0!==d&&a.h.push(d);return a}function N(a,b){a=a.g.get(b);return void 0==a?0:a}
class O{constructor(){this.g=new Map;this.h=[];this.actions=new Map;window.addEventListener("keydown",a=>{L(this,!0,a.code);this.h.includes(a.code)&&a.preventDefault()});window.addEventListener("keyup",a=>{L(this,!1,a.code);this.h.includes(a.code)&&a.preventDefault()});window.addEventListener("contextmenu",a=>a.preventDefault());window.addEventListener("mousemove",()=>window.focus());window.addEventListener("mousedown",()=>window.focus())}update(){for(let a of this.g.keys())3===this.g.get(a)?this.g.set(a,
1):2===this.g.get(a)&&this.g.set(a,0)}};class P{constructor(a,b){this.step=1;this.keyboard=a;this.audio=b}}function Q(a,b){const c=16.66667*a.h.step;a.g+=b-a.i;a.g=Math.min(5*c,a.g);a.i=b;for(b=a.g/c|0;0<b--;)a.l(a.h),a.keyboard.update(),a.g-=c;a.j(a.m);window.requestAnimationFrame(d=>Q(a,d))}function R(a,b=()=>{},c=()=>{},d=()=>{}){a.l=c;a.j=d;b(a.h);Q(a,0)}class S{constructor(){this.i=this.g=0;this.l=()=>{};this.j=()=>{};this.m=new G(144);this.keyboard=new O;this.audio=new p;this.h=new P(this.keyboard,this.audio)}};class T{constructor(a=0,b=0){this.x=a;this.y=b}};function U(a,b,c,d){var e=a.g*Math.PI*2;e=new T(96*Math.cos(e)/2,12*Math.sin(e)/2);let g=Math.sin(a.j),f=Math.cos(a.j);a=new T(a.h.x+f*e.x+g*e.y,a.h.y-g*e.x+f*e.y);A(b,c,96,16*d,16,16,Math.round(a.x)-8,Math.round(a.y)-8)}class V{constructor(a,b=0){this.i=()=>.5>=this.g;this.h=new T(80,64);this.g=b;this.j=a;this.speed=1/120}update(a){this.g=(this.g+this.speed*a.step)%1}};const W=[0,56,62,-1],X=[0,56,36,-1],Y=[0,16,32,-1],Z=[0,6,27,-1],aa=[W,W,W,W,W,W,W,W,W,W,W,W,[0,56,32,-1],Y,W,W,W,W,W,W,W,W,W,W,W,W,Y,Y,W,W,W,W,W,W,W,W,W,W,W,W,[0,47,27,-1],Z,X,X,X,X,X,X,X,X,X,X,X,X,Z,Z];
function ba(a,b){I(c=>{if(null==c)c=null;else{var d=document.createElement("canvas");d.width=c.width;d.height=c.height;var e=d.getContext("2d");e.drawImage(c,0,0);var g=e.getImageData(0,0,c.width,c.height),f=c.width/8|0,k=c.height/8|0;for(let t=0;t<k;++t)for(let u=0;u<f;++u){var h=void 0,m=void 0,n=g,w=c.width,x=8*u;m=8*t;var r=8*(u+1),ca=8*(t+1),B=b,da=aa[t*f+u];for(let C=m;C<ca;++C)for(let D=x;D<r;++D){m=C*w+D;h=n.data;var E=4*m;h=[0,1,2,3][((h[E]/85|0)+(h[E+1]/85|0)+(h[E+2]/85|0))/3|0];h=da[h];
0>h?n.data[4*m+3]=0:(n.data[4*m]=B[3*h],n.data[4*m+1]=B[3*h+1],n.data[4*m+2]=B[3*h+2],n.data[4*m+3]=255)}}e.putImageData(g,0,0);c=d}a.i=c;a.loaded=!0})}function ea(a){const b=[[[85,85,170],[170,170,255],[255,255,255]],[[85,0,85],[170,85,170],[255,170,255]]];a.A=J(c=>{let d,e,g;for(let f=0;11>f;++f)for(let k=0;10>k;++k)d=Number(k%2==f%2),e=16*k,g=16*f,c.setFillColor(...b[d][0]).fillRect(e,g,16,16).setFillColor(...b[d][2]).fillRect(e,g,15,15).setFillColor(...b[d][1]).fillRect(e+1,g+1,14,14)})}
function fa(a,b,c=0){c=b.width/2-72+a.j+c;let d,e=2*Math.PI/9,g=a.j/b.width*Math.PI*2,f;for(let k=1;0<=k;--k){f=0;for(let h=0;9>h;++h)" "!="Have fun!".charAt(h)&&(++f,d=-Math.round(16*Math.sin(a.h+e*f+g)),F(b,a.B,"Have fun!".charAt(h),Math.round(c+16*h)+k,b.height-48+k+d))}}
class ha{constructor(a){this.s=this.m=this.j=this.h=this.l=0;this.B=this.C=this.A=this.i=null;this.loaded=!1;a=a.audio;this.u=[];this.u.push(a.o([[128,4],[144,6],[160,12]],.3,"square",2,.5),a.o([[192,6],[240,6],[192,6],[160,20]],.7,"triangle",0,.2),a.o([[256,6],[192,8],[160,12]],.3,"sawtooth",1),a.o([[256,6],[320,8],[224,20]],.7,"sine",2,.1));a=Array(64);let b,c,d;for(let e=0;64>e;++e)b=e>>4,c=(e&12)>>2,d=e&3,a[3*e]=85*b,a[3*e+1]=85*c,a[3*e+2]=85*d;ba(this,a);ea(this);this.B=K("bold 24px Arial",32,
32,[255,170,0],!0);this.C=K("12px Arial",24,24);this.g=Array(2);this.g[0]=new V(Math.PI/8);this.g[1]=new V(-Math.PI/8,.5)}update(a){if(this.loaded){this.l=(this.l+.125*a.step)%4;this.h=(this.h+.05*a.step)%(2*Math.PI);this.j=(this.j+160/240*a.step)%160;this.m=(this.m+1*a.step)%232;{var b=a.keyboard;let d=b.actions.get("select");if(void 0===d)b=0;else{var c=N(b,d[0]);b=0==c&&void 0!==d[1]?N(b,d[1]):c}}3==b&&(this.u[this.s].play(1*a.audio.v),this.s=(this.s+1)%4);for(let d of this.g)d.update(a)}}};window.onload=()=>{let a;R(new S,b=>{M(M(M(M(M(M(M(M(b.keyboard,"right","ArrowRight","KeyD"),"up","ArrowUp","KeyW"),"left","ArrowLeft","KeyA"),"down","ArrowDown","KeyS"),"fire1","KeyZ"),"fire2","KeyX"),"start","Enter"),"select","Space");b.audio.v=.5;a=new ha(b)},b=>a.update(b),b=>{var c=a;if(c.loaded){var d=c.A,e=Math.abs(b.height-d.height)/2,g=2*Math.PI/d.width;for(var f=0;f<b.width;++f){var k=Math.round(Math.sin(c.h+g*f)*e);A(b,d,f,k+e,1,b.height,f,0)}for(e=0;e<c.g.length;++e)d=c.g[e],d.i()&&U(d,
b,c.i,e);g=32*[0,1,0,2][c.l|0];k=b.width/2;f=b.height/2+Math.round(16*Math.sin(c.h))+-8;var h=b.height/2+8,m=1-Math.abs(f-h)/64;d=z(b,.33).setFillColor(0);e=k;h+=16;var n=28*m;m=10*m;if(!(2>n||2>m)){e|=0;h|=0;n/=2;m/=2;var w=Math.round(m);for(let r=h-w;r<=h+w;++r){var x=Math.round(n*Math.sqrt(1-(r-h)*(r-h)/(m*m)));d.fillRect(e-x,r,2*x,1)}}A(z(b),c.i,g,0,32,32,k-16,f-16);for(e=0;e<c.g.length;++e)d=c.g[e],d.i()||U(d,b,c.i,e);for(d=0;2>d;++d)fa(c,b,-d*b.width);b.setFillColor(0,0,0,.33).fillRect(0,0,
b.width,14);for(d=0;2>d;++d)F(b,c.C,"Press SPACE to play sounds.  ",b.width/2-c.m+232*d,-6)}else b.clear(0)})};
</script>
</body>
</html>
